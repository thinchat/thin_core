<%= coffee_script_tag do %>
  class @ChatHandler
    @getMessages: (room_id) ->
      $.getJSON("http://localhost:3000/api/v1/messages?room_id=#{room_id}", ChatHandler.renderMessages)

    @renderMessages: (messages) =>
      for message in messages
        ChatHandler.addMessage(message)

    @handleMessage: (data) =>
      if (data.chat_message.message_type == "Message")
        ChatHandler.addMessage(data.chat_message)
      else
        ChatHandler.addEvent(data.chat_message)

    @addMessage: (message) =>
      $('#messages').append Mustache.to_html($('#message_template').html(), message)

    @addEvent: (message) =>
      $('#messages').append Mustache.to_html($('#event_template').html(), message)
<% end %>