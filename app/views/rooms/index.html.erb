<h1>Lobby</h1>
<%= link_to "Create a room", rooms_path, :method => :post %>

<div id="rooms"></div>
<div id="users"></div>

<script type="text/html" id="user_template">
  <p class="{{metadata.client_id}}">{{user_name}}</p>
</script>

<script type="text/html" id="room_template">
  <div id="room-{{name}}"><a href={{room_url}}>{{name}}</a></div>
</script>

<%= coffee_script_tag do %>
  jQuery ->
    location = $(".info").data("location")
    roomHandler = RoomHandler.getRooms("<%= api_v1_rooms_url %>", RoomsIndexRoomPresenter.renderRooms)
    userHandler = UserHandler.getUsers("<%= api_v1_users_url %>", RoomsIndexUserPresenter.renderUsers)
    user_hash = $.namespace.getUser(location)
    online_users = new FayeHandler("<%= FAYE_URL %>", user_hash, '/online/*')
    online_users.joinRoom(RoomsIndexUserPresenter.handleUser)
<% end %>