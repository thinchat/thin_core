<h1>Lobby</h1>
<%= link_to "Create a room", rooms_path, :method => :post %>

<div id="rooms"></div>

<script type="text/html" id="user_template">
  <p class="{{metadata.client_id}}">{{user_name}}</p>
</script>

<script type="text/html" id="room_user_template">
  <div id="room-{{name}}">
    <a href={{room_url}}>{{name}}</a>
    {{#users}}
      <p class="{{metadata.client_id}}">{{user_name}}</p>
    {{/users}}
  </div>
</script>

<%= coffee_script_tag do %>
  jQuery ->
    location = $(".info").data("location")   
    user_hash = $.namespace.getUser(location)
    online_users = new FayeHandler("<%= FAYE_URL %>", user_hash, '/online/*')
    online_users.joinRoom(RoomsIndexUserPresenter.handleUser)
    poller = new RoomsIndexRoomPoller("<%= api_v1_rooms_url %>?users=true")
<% end %>