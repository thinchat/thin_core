<% broadcast "/messages/#{@message.room_id}" do %>
messages = $("#messages").find(".message");
if (messages.length >= 15) {
  messages.first().remove();
}
messages.parent().append("<%= escape_javascript render(@message) %>");
<% end %>
$("#new_message")[0].reset();
